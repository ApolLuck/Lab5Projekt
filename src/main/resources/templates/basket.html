<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{basket.title}"></title>
    <!-- Custom CSS -->
    <link th:href="@{/css/basketStyle.css}" rel="stylesheet">
</head>
<body>

<!-- Górne menu -->
<div class="navbar">
    <a th:href="@{/}" class="nav-button" th:text="#{navbar.home}"></a>
    <a th:href="@{/menu}" class="nav-button" th:text="#{navbar.menu}"></a>
    <a th:href="@{/promotions}" class="nav-button" th:text="#{navbar.promotions}"></a>
    <a th:href="@{/gallery}" class="nav-button" th:text="#{navbar.gallery}"></a>
    <a th:href="@{/basket}" class="nav-button" th:text="#{navbar.basket}"></a>
    <a th:href="@{/yourOrder}" class="nav-button" th:text="#{navbar.orders}"></a>
</div>

<!-- Lista zamówień -->
<div class="order-list">
    <div th:each="orderItem : ${orderItems}" class="order-item" th:data-pizzaid="${orderItem.pizza.id}" th:data-price="${orderItem.price}">
        <h4 th:text="${orderItem.pizza.id} + '. ' + ${orderItem.pizza.nazwa} + ' (' + ${orderItem.pizza.rozmiar}
                    + ') - ' + ${orderItem.pizza.coverType.nazwa} + '. ' + #{basket.price} + ' ' + ${orderItem.price} + ' zł'"></h4>
        <div>
            <button class="value-button" th:onclick="'decreaseItemQuantity(' + ${orderItem.id} + ')'" th:text="#{basket.decrease}"></button>
            <input
                    type="number"
                    th:id="'quantity-' + ${orderItem.id}"
                    th:value="${orderItem.quantity}"
                    readonly
            />
            <button class="value-button" th:onclick="'increaseItemQuantity(' + ${orderItem.id} + ')'" th:text="#{basket.increase}"></button>
        </div>
        <div>
            <p th:id="'order-item-value-' + ${orderItem.id}"
               th:text="(${orderItem.quantity} * ${orderItem.price}) + ' zł'">
            </p>
        </div>
    </div>
    <!-- Sumaryczna cena zamówienia -->
    <div class="total-price">
        <h3 th:text="#{basket.total.value} + ': '"></h3>
        <span id="total-order-value">0</span> zł
    </div>
</div>

<!-- Kontener z kodem rabatowym i przyciskiem "Zastosuj" oraz "Do kasy" -->
<div class="discount-container">
    <input type="text" id="discount-code" th:placeholder="#{basket.discount.placeholder}">
    <button onclick="applyDiscount()" th:text="#{basket.apply}"></button>

    <form th:action="@{/createOrder}" method="post" onsubmit="copyTotalOrderValueToHiddenField()">
        <!-- Pętla do ukrytych pól dla każdego elementu zamówienia -->
        <div th:each="orderItem : ${orderItems}">
            <input type="hidden" th:name="'items[' + ${orderItem.id} + '].orderItemId'" th:value="${orderItem.id}">
            <input type="hidden" th:name="'items[' + ${orderItem.id} + '].pizzaId'" th:value="${orderItem.pizza.id}">
            <input type="hidden" th:name="'items[' + ${orderItem.id} + '].price'" th:value="${orderItem.price}">
            <input type="hidden" th:name="'items[' + ${orderItem.id} + '].quantity'"
                   th:value="${orderItem.quantity}" th:id="'hidden-quantity-' + ${orderItem.id}">
        </div>

        <!-- Ukryte pole dla sumarycznej wartości zamówienia -->
        <input type="hidden" id="hidden-total-order-value" name="totalOrderValue" value="0">

        <!-- Ukryte pole dla ciasteczka -->
        <input type="hidden" th:name="userCookies" th:value="${UserCookies}" />

        <!-- Przycisk do wysłania formularza -->
        <button type="submit" class="button" th:text="#{basket.checkout}"></button>
    </form>
</div>

<!-- Stopka -->
<footer>
    <p class="mb-0" th:text="#{homepage.footer}"></p>
    <div class="language-selection">
        <a href="?lang=pl">
            <img src="https://flagcdn.com/w2560/pl.png" alt="Polski" class="flag-icon">
        </a>
        <a href="?lang=en">
            <img src="https://flagcdn.com/w2560/gb.png" alt="English" class="flag-icon">
        </a>
    </div>
</footer>

<!-- Custom JS -->
<script th:src="@{/css/js/OrderScript.js}"></script>
</body>
</html>
